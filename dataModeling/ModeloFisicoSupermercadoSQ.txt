CREATE DATABASE "SUPERMERCADOSQ";

CREATE TABLE USUARIO (
	ID_USUARIO SERIAL PRIMARY KEY,
	EMAIL VARCHAR(50) NOT NULL,
	SENHA VARCHAR(50) NOT NULL
);

CREATE TABLE CLIENTE (
	CPF VARCHAR(15) PRIMARY KEY,
	NOME VARCHAR(50) NOT NULL,
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE ADMINISTRADOR (
	MATRICULA SERIAL PRIMARY KEY,
	NOME VARCHAR(50) NOT NULL,
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE FORNECEDOR (
	CNPJ VARCHAR(20) PRIMARY KEY,
	NOME VARCHAR(50) NOT NULL,
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE ENDERECO (
	ID_ENDERECO SERIAL PRIMARY KEY,
	LOGRADOURO VARCHAR(30) NOT NULL,
	NUMERO VARCHAR(5),
	BAIRRO VARCHAR(15),
	CIDADE VARCHAR(15),
	ESTADO VARCHAR(15),
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE TELEFONE(
	ID_TELEFONE SERIAL PRIMARY KEY,
	DDD CHAR(3) NOT NULL,
	NUMERO VARCHAR(10),
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE PRODUTO(
	ID_PRODUTO SERIAL PRIMARY KEY,
	NOME VARCHAR(50),
	INGREDIENTES TEXT,
	IMAGEM BYTEA,
	CNPJ_FORNECEDOR VARCHAR(20),
	FOREIGN KEY (CNPJ_FORNECEDOR) REFERENCES FORNECEDOR(CNPJ)
);

CREATE TABLE COMENTARIO(
	ID_COMENTARIO SERIAL PRIMARY KEY,
	MENSAGEM TEXT,
	STATUS VARCHAR(9),
	CONSTRAINT STATUS CHECK(STATUS IN('ANALISE', 'APROVADO', 'REPROVADO')),
	ID_PRODUTO INTEGER,
	FOREIGN KEY (ID_PRODUTO) REFERENCES PRODUTO(ID_PRODUTO),
	ID_USUARIO INTEGER,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
	MAT_ADMINISTRADOR INTEGER,
	FOREIGN KEY (MAT_ADMINISTRADOR) REFERENCES ADMINISTRADOR(MATRICULA)
);

CREATE TABLE ADM_PROD(
	COD SERIAL PRIMARY KEY,
	MAT_ADMINISTRADOR INTEGER,
	FOREIGN KEY (MAT_ADMINISTRADOR) REFERENCES ADMINISTRADOR(MATRICULA),
	ID_PRODUTO INTEGER,
	FOREIGN KEY (ID_PRODUTO) REFERENCES PRODUTO(ID_PRODUTO)
);