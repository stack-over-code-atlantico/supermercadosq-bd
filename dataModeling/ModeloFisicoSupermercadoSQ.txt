CREATE DATABASE "SUPERMERCADOSQ";

CREATE TABLE USUARIO (
	ID_USUARIO SERIAL PRIMARY KEY,
	NOME VARCHAR(50) NOT NULL,
	CPF_CNPJ VARCHAR(20) NOT NULL UNIQUE,
	EMAIL VARCHAR(50) NOT NULL,
	SENHA VARCHAR(50) NOT NULL,
	NIVEL VARCHAR(15),
	CONSTRAINT NIVEL CHECK(NIVEL IN('ADMINISTRADOR', 'CLIENTE', 'FORNECEDOR')),
	NOME_SOCIAL VARCHAR(50),
	ATIVO BOOLEAN NOT NULL,
	TELEFONE VARCHAR(11),
	RESTRICAO_ALIMENTICIA VARCHAR(40)	
);

CREATE TABLE ENDERECO (
	ID_ENDERECO SERIAL PRIMARY KEY,
	LOGRADOURO VARCHAR(100) NOT NULL,
	NUMERO VARCHAR(5) NOT NULL,
	BAIRRO VARCHAR(15) NOT NULL,
	CIDADE VARCHAR(15) NOT NULL,
	ESTADO VARCHAR(15) NOT NULL,
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE PRODUTO(
	ID_PRODUTO SERIAL PRIMARY KEY,
	NOME VARCHAR(50) NOT NULL,
	INGREDIENTES TEXT NOT NULL,
	IMAGEM BYTEA,
	DATA_POSTAGEM DATE NOT NULL,
	EDITADO BOOLEAN,
	STATUS VARCHAR(9),
	CONSTRAINT STATUS CHECK(STATUS IN('ANALISE', 'APROVADO', 'REPROVADO')),
	FEEDBACKS_PRODUTOS INT,
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
	ID_APROVADO INTEGER,
	FOREIGN KEY (ID_APROVADO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE COMENTARIO(
	ID_COMENTARIO SERIAL PRIMARY KEY,
	MENSAGEM TEXT NOT NULL,
	STATUS VARCHAR(9),
	CONSTRAINT STATUS CHECK(STATUS IN('ANALISE', 'APROVADO', 'REPROVADO')),
	DATA_COMENTARIO DATE NOT NULL,
	EDITADO BOOLEAN,
	FEEDBACKS_COMENTARIOS INT,
	ID_PRODUTO INTEGER NOT NULL,
	FOREIGN KEY (ID_PRODUTO) REFERENCES PRODUTO(ID_PRODUTO),
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
	ID_APROVADO INTEGER,
	FOREIGN KEY (ID_APROVADO) REFERENCES USUARIO(ID_USUARIO)
);
