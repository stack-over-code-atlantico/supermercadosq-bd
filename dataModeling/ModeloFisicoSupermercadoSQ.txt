CREATE DATABASE "SUPERMERCADOSQ";

CREATE TABLE USUARIO (
	ID_USUARIO SERIAL PRIMARY KEY,
	NOME_SOCIAL VARCHAR(50),
	EMAIL VARCHAR(50) NOT NULL,
	SENHA VARCHAR(50) NOT NULL,
	TELEFONE VARCHAR(11),
	ATIVO BOOLEAN,
	TIPO_USUARIO VARCHAR(9),
	CONSTRAINT TIPO_USUARIO CHECK(TIPO_USUARIO IN('ADMINISTRADOR', 'CLIENTE', 'FORNECEDOR'))
);

CREATE TABLE CLIENTE (
	CPF_CNPJ VARCHAR(20) PRIMARY KEY,
	NOME VARCHAR(50) NOT NULL,
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE ADMINISTRADOR (
	MATRICULA SERIAL PRIMARY KEY,
	NOME VARCHAR(50) NOT NULL,
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE FORNECEDOR (
	CNPJ VARCHAR(20) PRIMARY KEY,
	RAZAO_SOCIAL VARCHAR(50) NOT NULL,
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE ENDERECO (
	ID_ENDERECO SERIAL PRIMARY KEY,
	LOGRADOURO VARCHAR(30) NOT NULL,
	NUMERO VARCHAR(5) NOT NULL,
	BAIRRO VARCHAR(15) NOT NULL,
	CIDADE VARCHAR(15) NOT NULL,
	ESTADO VARCHAR(15) NOT NULL,
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE TELEFONE(
	ID_TELEFONE SERIAL PRIMARY KEY,
	DDD CHAR(3) NOT NULL,
	NUMERO VARCHAR(10) NOT NULL,
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE PRODUTO(
	ID_PRODUTO SERIAL PRIMARY KEY,
	NOME VARCHAR(50) NOT NULL,
	INGREDIENTES TEXT NOT NULL,
	IMAGEM BYTEA,
	CNPJ_FORNECEDOR VARCHAR(20) NOT NULL,
	STATUS VARCHAR(9),
	CONSTRAINT STATUS CHECK(STATUS IN('ANALISE', 'APROVADO', 'REPROVADO')),
	FOREIGN KEY (CNPJ_FORNECEDOR) REFERENCES FORNECEDOR(CNPJ),
	MAT_ADMINISTRADOR INTEGER NOT NULL,
	FOREIGN KEY (MAT_ADMINISTRADOR) REFERENCES ADMINISTRADOR(MATRICULA),
	DATA_POSTAGEM DATE NOT NULL,
	EDITADO BOOLEAN
);

CREATE TABLE COMENTARIO(
	ID_COMENTARIO SERIAL PRIMARY KEY,
	MENSAGEM TEXT NOT NULL,
	STATUS VARCHAR(9),
	CONSTRAINT STATUS CHECK(STATUS IN('ANALISE', 'APROVADO', 'REPROVADO')),
	ID_PRODUTO INTEGER NOT NULL,
	FOREIGN KEY (ID_PRODUTO) REFERENCES PRODUTO(ID_PRODUTO),
	ID_USUARIO INTEGER NOT NULL,
	FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
	MAT_ADMINISTRADOR INTEGER,
	FOREIGN KEY (MAT_ADMINISTRADOR) REFERENCES ADMINISTRADOR(MATRICULA),
	DATA_COMENTARIO DATE NOT NULL,
	EDITADO BOOLEAN
);
